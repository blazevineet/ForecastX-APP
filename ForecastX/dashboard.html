<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    
    <script>
        const token = localStorage.getItem('userToken');
        if (!token) {
            window.location.href = 'login.html';
        }
    </script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Forecast - ForecastX</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    
    <script>
        (function() {
            const theme = localStorage.getItem('theme');
            if (theme === 'dark') {
                document.documentElement.classList.add('dark-mode');
            }
        })();
    </script>
    
    <style>
        /* Base styles */
        :root {
            --primary-blue: #007bff;
            --light-blue-bg: #e0f2ff;
            --gradient-start: #d4f0ff;
            --gradient-end: #a9d9ff;
            --text-primary: #333;
            --text-secondary: #555;
            --card-bg: #ffffff;
            --card-bg-light: #f8fcff;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --error-red: #d93025;
            --status-good: #1e8e3e;
            --status-good-bg: #e6f4ea;
            --status-warn: #f9ab00;
            --status-warn-bg: #fff8e6;
            --status-bad: #d93025;
            --status-bad-bg: #fce8e6;
        }
        
        /* Dark Mode Theme */
        html.dark-mode {
            --gradient-start: #1e3c58;
            --gradient-end: #111827;
            --text-primary: #f9fafb;
            --text-secondary: #9ca3af;
            --card-bg: #1f2937;
            --card-bg-light: #374151;
            --light-blue-bg: #374151; 
            --status-good: #5bb974;
            --status-good-bg: #283c2e;
            --status-warn: #fdd663;
            --status-warn-bg: #423820;
            --status-bad: #f28b82;
            --status-bad-bg: #4c2b29;
        }

        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            color: var(--text-primary);
            transition: background-color 0.3s, color 0.3s;
        }

        /* --- 2. Navigation Bar --- */
        .navbar {
            background-color: var(--card-bg);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 10px 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.3s;
        }
        .nav-links {
            display: flex;
            gap: 15px;
        }
        .nav-link {
            text-decoration: none;
            color: var(--text-secondary);
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 500;
            transition: background-color 0.2s, color 0.2s;
        }
        .nav-link:hover,
        .nav-link.active {
            background-color: var(--light-blue-bg);
            color: var(--primary-blue);
        }
        html.dark-mode .nav-link:hover,
        html.dark-mode .nav-link.active {
            color: #7dd3fc;
        }
        .auth-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .btn {
            font-family: 'Poppins', sans-serif;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            border: 2px solid var(--primary-blue);
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-primary {
            background-color: var(--primary-blue);
            color: white;
        }
        .btn-primary:hover {
            background-color: #0056b3;
            border-color: #0056b3;
        }
        .btn-secondary {
            background-color: transparent;
            color: var(--primary-blue);
        }
        .btn-secondary:hover {
            background-color: var(--light-blue-bg);
        }
        html.dark-mode .btn-secondary {
            background-color: var(--card-bg);
            border-color: #374151;
        }
        html.dark-mode .btn-secondary:hover {
            background-color: var(--light-blue-bg);
        }
        .btn-icon {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--primary-blue);
            color: var(--primary-blue);
            background-color: transparent;
            cursor: pointer;
            transition: all 0.2s;
            padding: 0;
        }
        .btn-icon:hover {
            background-color: var(--light-blue-bg);
        }
        .btn-icon svg {
            width: 22px;
            height: 22px;
            fill: currentColor;
        }
        html.dark-mode .btn-icon {
            background-color: var(--card-bg);
            border-color: #374151;
        }
        html.dark-mode .btn-icon:hover {
            background-color: var(--light-blue-bg);
        }

        /* --- 3. Main Content --- */
        .main-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 30px 20px;
            text-align: center;
            gap: 30px; 
        }
        #loader {
            font-size: 1.2rem;
            color: var(--text-secondary);
            padding: 50px;
        }
        .forecast-section, .travel-section {
            width: 100%;
            max-width: 1000px;
        }
        
        h1 {
            font-size: 2rem;
            font-weight: 600;
            margin: 0; 
        }
        #error-message {
            color: var(--error-red);
            font-weight: 500;
            font-size: 0.9rem;
            margin-top: 10px; 
            display: none; 
        }
        h2 {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }
        
        /* --- 4. Current Weather Card --- */
        .current-weather-card {
            background-color: var(--card-bg-light);
            border: 1px solid var(--light-blue-bg);
            border-radius: 20px;
            padding: 24px 32px;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 1000px;
            box-sizing: border-box; 
            margin-top: 20px; 
        }
        
        .current-main {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-basis: 300px; 
            flex-grow: 1; 
        }
        #current-icon {
            font-size: 4rem;
            line-height: 1;
        }
        #current-temp {
            font-size: 3.5rem;
            font-weight: 600;
            margin: -10px 0;
        }
        #current-condition {
            font-size: 1.25rem;
            color: var(--text-secondary);
            text-transform: capitalize;
        }
        
        /* UPDATED: 3 columns */
        .current-details {
            display: grid;
            grid-template-columns: repeat(3, 1fr); 
            gap: 20px;
            flex-basis: 500px; 
            flex-grow: 1; 
            border-left: 1px solid var(--light-blue-bg);
            padding-left: 24px;
        }
        
        html.dark-mode .current-details {
             border-left-color: #374151;
        }

        .detail-card {
            background-color: var(--card-bg);
            padding: 16px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            text-align: left;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .detail-card .icon {
            font-size: 1.5rem;
            color: var(--primary-blue);
        }
        .detail-card-info span {
            display: block;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        .detail-card-info b {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* --- 5. Forecast Grid (5-Day) --- */
        .forecast-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
        }
        .forecast-card {
            background-color: var(--card-bg-light);
            border: 1px solid var(--light-blue-bg);
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: background-color 0.3s;
        }
        .forecast-card .day {
            font-weight: 600;
            font-size: 1rem;
        }
        .forecast-card .icon {
            font-size: 2.5rem;
            margin: 8px 0;
        }
        .forecast-card .temp {
            font-size: 0.9rem;
            margin: 5px 0;
        }
        .forecast-card .condition {
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-transform: capitalize;
        }

        /* --- 6. Travel Recommendations --- */
        .travel-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            text-align: left;
        }
        .travel-card {
            background-color: var(--card-bg);
            padding: 20px 25px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            transition: all 0.3s;
            border-left: 5px solid var(--primary-blue); 
        }
        .travel-card.status-good {
            border-left-color: var(--status-good);
            background-color: var(--status-good-bg);
        }
        .travel-card.status-warn {
            border-left-color: var(--status-warn);
            background-color: var(--status-warn-bg);
        }
        .travel-card.status-bad {
            border-left-color: var(--status-bad);
            background-color: var(--status-bad-bg);
        }
        .travel-card h3 {
            color: var(--text-primary);
            font-size: 1.2rem;
            margin-top: 0;
            margin-bottom: 10px;
        }
        .travel-card.status-good h3 { color: var(--status-good); }
        .travel-card.status-warn h3 { color: var(--status-warn); }
        .travel-card.status-bad h3 { color: var(--status-bad); }
        .travel-card p {
            font-size: 0.95rem;
            color: var(--text-secondary);
            margin: 0;
        }
        
        /* --- 7. Responsive --- */
        @media (max-width: 900px) {
            .current-weather-card {
                flex-direction: column;
                gap: 24px;
            }
            .current-details {
                border-left: none;
                padding-left: 0;
                width: 100%;
                grid-template-columns: repeat(2, 1fr); /* 2 cols on tablet */
            }
        }
        @media (max-width: 600px) {
            .details-grid, .current-details {
                grid-template-columns: 1fr;
            }
            .forecast-grid {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            }
            .travel-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>

    <header class="navbar">
        <div class="nav-links">
            <a href="index.html" class="nav-link">Home</a>
            <a href="dashboard.html" class="nav-link active">Forecast</a>
            <a href="alerts.html" class="nav-link">Alerts</a>
            <a href="http://googleusercontent.com/maps/google.com/0" target="_blank" class="nav-link">Maps</a>
            <a href="settings.html" class="nav-link">Settings</a>
        </div>
        <div class="auth-buttons">
            </div>
    </header>

    <main class="main-content">
        
        <div id="loader">Loading forecast...</div>
        
        <div id="weather-content" style="display: none;">
        
            <section class="forecast-section">
                
                <h1 id="location-header">Weather Forecast for...</h1>
                <div id="error-message"></div>
                
                <div class="current-weather-card">
                    <div class="current-main">
                        <div id="current-icon">‚òÄÔ∏è</div>
                        <div>
                            <div id="current-temp">28¬∞C</div>
                            <div id="current-condition">Sunny</div>
                        </div>
                    </div>
        
                    <div class="current-details">
                        <div class="detail-card">
                            <div class="icon">üíß</div>
                            <div class="detail-card-info">
                                <span>Humidity</span>
                                <b id="humidity">60%</b>
                            </div>
                        </div>
                        <div class="detail-card">
                            <div class="icon">üí®</div>
                             <div class="detail-card-info">
                                <span>Wind Speed</span>
                                <b id="wind-speed">10 km/h</b>
                            </div>
                        </div>
                        <div class="detail-card">
                            <div class="icon">üå°Ô∏è</div>
                             <div class="detail-card-info">
                                <span>Pressure</span>
                                <b id="pressure">1013 hPa</b>
                            </div>
                        </div>
                        <div class="detail-card">
                            <div class="icon">üëÅÔ∏è</div>
                             <div class="detail-card-info">
                                <span>Visibility</span>
                                <b id="visibility">10 km</b>
                            </div>
                        </div>
                        <div class="detail-card">
                            <div class="icon">üåÖ</div>
                             <div class="detail-card-info">
                                <span>Sunrise</span>
                                <b id="sunrise">6:10 AM</b>
                            </div>
                        </div>
                        <div class="detail-card">
                            <div class="icon">üåá</div>
                             <div class="detail-card-info">
                                <span>Sunset</span>
                                <b id="sunset">5:45 PM</b>
                            </div>
                        </div>
                    </div>
                </div>
                
                <h2 style="margin-top: 40px;">5-Day Forecast</h2>
                <div class="forecast-grid" id="forecast-grid">
                    </div>
            </section>

            <section class="travel-section" id="travel-section">
                <h2>Travel Recommendations</h2>
                <div class="travel-grid">
                    <div class="travel-card" id="travel-flight-card">
                        <h3>‚úàÔ∏è Flight Impact</h3>
                        <p id="travel-flight">No weather-related flight delays expected. Visibility is excellent.</p>
                    </div>
                    <div class="travel-card" id="travel-road-card">
                        <h3>üöó Road Conditions</h3>
                        <p id="travel-road">Ideal driving conditions. No weather-related advisories in effect.</p>
                    </div>
                    <div class="travel-card" id="travel-packing-card">
                        <h3>üéí Packing Advice</h3>
                        <p id="travel-packing">Light clothing recommended. Don't forget sunscreen and sunglasses.</p>
                    </div>
                    <div class="travel-card" id="travel-outdoor-card">
                        <h3>üèûÔ∏è Outdoor Activities</h3>
                        <p id="travel-outdoor">Perfect weather for sightseeing.</p>
                    </div>
                </div>
            </section>
        
        </div> </main>

    <script>
        // --- 0. AUTHENTICATION CHECK ---
        (function checkLoginStatus() {
            const token = localStorage.getItem('userToken');
            const authButtons = document.querySelector('.auth-buttons');
            
            if (token) {
                authButtons.innerHTML = `
                    <a href="settings.html" class="btn btn-icon" title="Profile & Settings">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
                            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                        </svg>
                    </a>
                    <a href="#" id="logout-btn" class="btn btn-secondary">Logout</a>
                `;
                
                document.getElementById('logout-btn').addEventListener('click', (e) => {
                    e.preventDefault();
                    localStorage.removeItem('userToken');
                    localStorage.removeItem('userEmail');
                    window.location.href = 'index.html'; 
                });
            } else {
                authButtons.innerHTML = `
                    <a href="login.html" class="btn btn-primary">Sign In</a>
                    <a href="register.html" class="btn btn-secondary">Register</a>
                `;
            }
        })();

        // --- 1. CONFIGURATION ---
        const API_KEY = '6dc9025a4d9b16ee776d967535633a80'; 
        
        const userUnits = localStorage.getItem('units') || 'metric'; 
        const unitSymbol = (userUnits === 'metric') ? '¬∞C' : '¬∞F';
        const windSymbol = (userUnits === 'metric') ? 'km/h' : 'mph';
        
        let localTimeInterval; // NEW: To hold our clock's interval

        // --- 2. DOM ELEMENTS ---
        const loader = document.getElementById('loader');
        const weatherContent = document.getElementById('weather-content');
        const locationHeader = document.getElementById('location-header');
        const errorMessage = document.getElementById('error-message');
        const currentIcon = document.getElementById('current-icon');
        const currentTemp = document.getElementById('current-temp');
        const currentCondition = document.getElementById('current-condition');
        const humidity = document.getElementById('humidity');
        const windSpeed = document.getElementById('wind-speed');
        const pressure = document.getElementById('pressure');
        const visibility = document.getElementById('visibility');
        const sunrise = document.getElementById('sunrise'); // NEW
        const sunset = document.getElementById('sunset'); // NEW
        const forecastGrid = document.getElementById('forecast-grid');
        const travelSection = document.getElementById('travel-section');
        const travelFlightCard = document.getElementById('travel-flight-card');
        const travelRoadCard = document.getElementById('travel-road-card');
        const travelPackingCard = document.getElementById('travel-packing-card');
        const travelOutdoorCard = document.getElementById('travel-outdoor-card');
        const travelFlight = document.getElementById('travel-flight');
        const travelRoad = document.getElementById('travel-road');
        const travelPacking = document.getElementById('travel-packing');
        const travelOutdoor = document.getElementById('travel-outdoor');

        // --- 3. CORE FUNCTIONS ---
        (function startWeatherLogic() {
            const urlParams = new URLSearchParams(window.location.search);
            const location = urlParams.get('location');

            if (API_KEY === 'YOUR_API_KEY_HERE' || API_KEY === '') {
                showFallbackData('API Key is missing. Showing offline data.', location || 'Offline');
                return;
            }
            
            if (location) {
                getCoordsForCity(location);
            } else {
                getWeatherByGps();
            }
        })();

        function getWeatherByGps() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const { latitude, longitude } = position.coords;
                        fetchWeather(latitude, longitude, 'Your Location');
                    },
                    (error) => {
                        showFallbackData('Could not get your location. Showing offline data.', 'Your Location');
                    }
                );
            } else {
                showFallbackData('GPS not supported. Showing offline data.', 'Offline');
            }
        }

        async function getCoordsForCity(city) {
            const geoUrl = `https://api.openweathermap.org/geo/1.0/direct?q=${city}&limit=1&appid=${API_KEY}`;
            
            try {
                const response = await fetch(geoUrl);
                if (!response.ok) throw new Error('Network response was not ok');
                
                const data = await response.json();
                if (data.length === 0) {
                    throw new Error(`City not found: '${city}'. Please check the spelling.`);
                }
                
                const { lat, lon, name, country } = data[0];
                const displayName = `${name}, ${country}`;
                fetchWeather(lat, lon, displayName);
                
            } catch (error) {
                console.error('Fetch Coords Error:', error);
                showFallbackData(error.message, city);
            }
        }

        async function fetchWeather(lat, lon, name) {
            const currentWeatherUrl = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=${userUnits}`;
            const forecastUrl = `https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=${userUnits}`;

            try {
                const [currentResponse, forecastResponse] = await Promise.all([
                    fetch(currentWeatherUrl),
                    fetch(forecastUrl)
                ]);

                if (!currentResponse.ok) throw new Error('Current weather data not available');
                if (!forecastResponse.ok) throw new Error('Forecast data not available');
                
                const currentData = await currentResponse.json();
                const forecastData = await forecastResponse.json();
                
                loader.style.display = 'none';
                weatherContent.style.display = 'block';
                errorMessage.style.display = 'none'; 
                
                locationHeader.textContent = `Weather Forecast for ${name}`;

                populateCurrentWeather(currentData);
                populateForecast(forecastData.list);
                populateTravel(currentData);

            } catch (error) {
                console.error('Fetch Weather Error:', error);
                showFallbackData(error.message, name);
            }
        }
        
        function populateCurrentWeather(current) {
            currentIcon.textContent = getWeatherIcon(current.weather[0].id);
            currentTemp.textContent = `${Math.round(current.main.temp)}${unitSymbol}`;
            currentCondition.textContent = current.weather[0].description;
            humidity.textContent = `${current.main.humidity}%`;
            
            const wind = (userUnits === 'metric') 
                ? Math.round(current.wind.speed * 3.6) // m/s to km/h
                : Math.round(current.wind.speed);      // already in mph
            windSpeed.textContent = `${wind} ${windSymbol}`;
            
            pressure.textContent = `${current.main.pressure} hPa`;
            visibility.textContent = `${(current.visibility / 1000).toFixed(1)} km`;
            
            // NEW: Populate Sunrise/Sunset
            // We pass the 'timezone' offset (in seconds) from the API
            sunrise.textContent = formatTime(current.sys.sunrise, current.timezone);
            sunset.textContent = formatTime(current.sys.sunset, current.timezone);
        }
        
        /**
         * NEW: Helper function to format UNIX timestamp to local time
         * @param {number} timestamp - UNIX timestamp (e.g., 1661834187)
         * @param {number} timezoneOffset - Shift from UTC in seconds (e.g., -14400)
         */
        function formatTime(timestamp, timezoneOffset) {
            // Create a date object in UTC
            const date = new Date((timestamp + timezoneOffset) * 1000);
            const options = {
                hour: 'numeric',
                minute: 'numeric',
                hour12: true,
                timeZone: 'UTC' // Important: We've already applied the offset
            };
            return date.toLocaleString('en-US', options);
        }

        function populateForecast(forecastList) {
            forecastGrid.innerHTML = '';
            const dailyData = {};

            for (const item of forecastList) {
                const date = new Date(item.dt * 1000);
                const day = date.toISOString().split('T')[0]; 

                if (!dailyData[day]) {
                    dailyData[day] = {
                        dayName: new Date(item.dt * 1000).toLocaleDateString('en-US', { weekday: 'short' }),
                        min: item.main.temp_min,
                        max: item.main.temp_max,
                        condition: item.weather[0].description,
                        icon: item.weather[0].id 
                    };
                } else {
                    if (item.main.temp_min < dailyData[day].min) {
                        dailyData[day].min = item.main.temp_min;
                    }
                    if (item.main.temp_max > dailyData[day].max) {
                        dailyData[day].max = item.main.temp_max;
                    }
                    if (item.dt_txt.includes("12:00:00")) {
                        dailyData[day].condition = item.weather[0].description;
                        dailyData[day].icon = item.weather[0].id;
                    }
                }
            }
            
            const forecastDays = Object.values(dailyData);
            if (forecastDays[0].dayName === new Date().toLocaleDateString('en-US', { weekday: 'short' })) {
                 forecastDays.shift(); // Remove today
            }

            for (const day of forecastDays.slice(0, 5)) { // Get 5 days
                const card = document.createElement('div');
                card.className = 'forecast-card';
                card.innerHTML = `
                    <div class="day">${day.dayName}</div>
                    <div class="icon">${getWeatherIcon(day.icon)}</div>
                    <div class="temp">${Math.round(day.max)}¬∞ / ${Math.round(day.min)}¬∞</div>
                    <div class="condition">${day.condition}</div>
                `;
                forecastGrid.appendChild(card);
            }
        }
        
        function populateTravel(current) {
            // Flight Impact
            if (current.visibility < 1000) { 
                travelFlight.textContent = 'Potential flight delays. Visibility is very poor.';
                travelFlightCard.className = 'travel-card status-bad';
            } else if (current.wind.speed > 15) { 
                travelFlight.textContent = 'Moderate turbulence expected. Strong crosswinds possible.';
                travelFlightCard.className = 'travel-card status-warn';
            } else {
                travelFlight.textContent = 'No weather-related flight delays expected. Visibility is excellent.';
                travelFlightCard.className = 'travel-card status-good';
            }

            // Road Conditions
            const weatherId = current.weather[0].id;
            if (weatherId >= 500 && weatherId < 600) { // Rain
                travelRoad.textContent = 'Wet roads. Risk of hydroplaning. Drive with caution.';
                travelRoadCard.className = 'travel-card status-warn';
            } else if (weatherId >= 600 && weatherId < 700) { // Snow
                travelRoad.textContent = 'Slippery roads. Snowfall reported. Use extreme caution.';
                travelRoadCard.className = 'travel-card status-bad';
            } else {
                travelRoad.textContent = 'Ideal driving conditions. No weather-related advisories in effect.';
                travelRoadCard.className = 'travel-card status-good';
            }

            // Packing Advice
            const maxTemp = current.main.temp_max;
            if ((userUnits === 'metric' && maxTemp > 30) || (userUnits === 'imperial' && maxTemp > 86)) {
                travelPacking.textContent = 'Very hot. Pack light, breathable clothing, sunscreen, and a hat.';
                travelPackingCard.className = 'travel-card status-warn'; 
            } else if ((userUnits === 'metric' && maxTemp > 10) || (userUnits === 'imperial' && maxTemp > 50)) {
                travelPacking.textContent = 'Warm/Mild weather. Light clothing recommended.';
                travelPackingCard.className = 'travel-card status-good';
            } else {
                travelPacking.textContent = 'Cold weather. Pack warm layers, a heavy coat, gloves, and a hat.';
                travelPackingCard.className = 'travel-card status-warn'; 
            }

            // Outdoor Activities
             if (weatherId >= 500 && weatherId < 700) { // Rain or Snow
                travelOutdoor.textContent = 'Precipitation expected. Good day for indoor activities.';
                travelOutdoorCard.className = 'travel-card status-warn';
            } else {
                travelOutdoor.textContent = 'Looks like a great day for outdoor activities. Enjoy!';
                travelOutdoorCard.className = 'travel-card status-good';
            }
        }

        function showFallbackData(errorText, locationName) {
            loader.style.display = 'none';
            weatherContent.style.display = 'block';
            
            locationHeader.textContent = `Weather for ${locationName} (Offline Data)`;
            errorMessage.textContent = `Error: ${errorText}`;
            errorMessage.style.display = 'block';

            const temp = (userUnits === 'metric') ? '28' : '82';
            const tempHi = (userUnits === 'metric') ? '32' : '90';
            const tempLo = (userUnits === 'metric') ? '25' : '77';
            const wind = (userUnits === 'metric') ? '10' : '6';

            currentIcon.textContent = '‚òÄÔ∏è';
            currentTemp.textContent = `${temp}${unitSymbol}`;
            currentCondition.textContent = 'Sunny';
            humidity.textContent = `60%`;
            windSpeed.textContent = `${wind} ${windSymbol}`;
            pressure.textContent = `1013 hPa`;
            visibility.textContent = `10 km`;
            sunrise.textContent = '6:10 AM'; // Hardcoded
            sunset.textContent = '5:45 PM'; // Hardcoded

            forecastGrid.innerHTML = `
                <div class="forecast-card"><div class="day">Tomorrow</div><div class="icon">üå§Ô∏è</div><div class="temp">${tempHi}¬∞ / ${tempLo}¬∞</div><div class="condition">Partly Cloudy</div></div>
                <div class="forecast-card"><div class="day">Day 3</div><div class="icon">üåßÔ∏è</div><div class="temp">31¬∞ / 24¬∞</div><div class="condition">Light Rain</div></div>
                <div class="forecast-card"><div class="day">Day 4</div><div class="icon">‚òÄÔ∏è</div><div class="temp">33¬∞ / 26¬∞</div><div class="condition">Sunny</div></div>
                <div class="forecast-card"><div class="day">Day 5</div><div class="icon">üå¶Ô∏è</div><div class="temp">30¬∞ / 24¬∞</div><div class="condition">Showers</div></div>
                <div class="forecast-card"><div class="day">Day 6</div><div class="icon">‚òÅÔ∏è</div><div class="temp">29¬∞ / 23¬∞</div><div class="condition">Cloudy</div></div>
            `;
            
            travelFlight.textContent = 'Offline data: Check with your airline for real-time updates.';
            travelFlightCard.className = 'travel-card status-warn';
            travelRoad.textContent = 'Offline data: Be cautious of changing road conditions.';
            travelRoadCard.className = 'travel-card status-warn';
            travelPacking.textContent = 'Offline data: Pack for sunny weather, but check for live updates.';
            travelPackingCard.className = 'travel-card status-good';
            travelOutdoor.textContent = 'Offline data: Conditions appear good, but verify before heading out.';
            travelOutdoorCard.className = 'travel-card status-good';
        }
        
        function getWeatherIcon(id) {
            if (id >= 200 && id < 300) return '‚õàÔ∏è'; 
            if (id >= 300 && id < 400) return 'üå¶Ô∏è'; 
            if (id >= 500 && id < 600) return 'üåßÔ∏è'; 
            if (id >= 600 && id < 700) return '‚ùÑÔ∏è'; 
            if (id >= 700 && id < 800) return 'üå´Ô∏è'; 
            if (id === 800) return '‚òÄÔ∏è'; 
            if (id === 801) return 'üå§Ô∏è'; 
            if (id === 802) return '‚õÖÔ∏è'; 
            if (id === 803 || id === 804) return '‚òÅÔ∏è'; 
            return '‚ùì';
        }
    </script>

</body>
</html>